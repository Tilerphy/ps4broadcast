!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t){function n(){["Object","Array","String","Number","Boolean","Function","RegExp","Date","Undefined","Null","Symbol","Blob","ArrayBuffer"].forEach(e=>{this["is".concat(e)]=t=>Object.prototype.toString.call(t).slice(8,-1)===e})}n.prototype.isBrowser=()=>"undefined"!=typeof window,n.prototype.random=(e,t)=>Math.floor(Math.random()*(t-e+1)+e),n.prototype.download=function(e,t){if(this.isBrowser()){var n=document.createElement("a");n.style.display="none";var i=new Blob([t]);n.download="".concat(e,".log"),n.href=URL.createObjectURL(i),document.body.appendChild(n),n.click(),URL.revokeObjectURL(i),document.body.removeChild(n)}},e.exports=new n},function(e,t,n){"use strict";var i=n(8);i.stt=n(3),i.util=n(0),i.logger=n(6),i.Websocket=n(5),i.packet=n(4),e.exports=i},function(e,t,n){var i=8500+n(0).random(1,6),r="wss://danmuproxy.douyu.com:".concat(i,"/");e.exports={URL:r,HEARBEAT_INTERVAL:45,MSG_LIVE_ON:"主播正在直播",MSG_LIVE_OFF:"主播没有直播",MSG_ROOM_RSS:"房间开播提醒",MSG_BC_BUY_DESERVE:"赠送酬勤通知",MSG_SSD:"超级弹幕",MSG_ROOM_SPBC:"房间内礼物广播"}},function(e,t,n){var i=n(0);e.exports=new class{escape(e){return i.isUndefined(e)?"":e.toString().replace(/@/g,"@A").replace(/\//g,"@S")}unescape(e){return i.isUndefined(e)?"":e.toString().replace(/@A/g,"@").replace(/@S/g,"/")}serialize(e){return i.isObject(e)?Object.keys(e).map(t=>"".concat(t,"@=").concat(this.escape(this.serialize(e[t])),"/")).join(""):Array.isArray(e)?e.map(e=>"".concat(this.escape(this.serialize(e)),"/")).join(""):i.isString(e)||i.isNumber(e)?e.toString():void 0}deserialize(e){return e.includes("//")?e.split("//").filter(e=>""!==e).map(e=>this.deserialize(e)):e.includes("@=")?e.split("/").filter(e=>""!==e).reduce((e,t)=>{var[n,i]=t.split("@=");return e[n]=this.deserialize(this.unescape(i)),e},{}):e.includes("@A=")?this.deserialize(this.unescape(e)):e.toString()}}},function(e,t,n){n(10);n(0);e.exports=new class{constructor(){this.HEADER_LEN_SIZE=4,this.HEADER_LEN_TYPECODE=2,this.HEADER_LEN_ENCRYPT=1,this.HEADER_LEN_PLACEHOLDER=1,this.HEADER_LEN_TOTAL=2*this.HEADER_LEN_SIZE+this.HEADER_LEN_TYPECODE+this.HEADER_LEN_ENCRYPT+this.HEADER_LEN_PLACEHOLDER,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.buffer=new ArrayBuffer(0),this.readLength=0}concat(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.reduce((function(e,t){var n=t instanceof ArrayBuffer?new Uint8Array(t):t,i=new Uint8Array(e.length+n.length);return i.set(e,0),i.set(n,e.length),i}),new Uint8Array(0))}Encode(e){var t=this.concat(this.encoder.encode(e),Uint8Array.of(0)),n=t.length+2*this.HEADER_LEN_SIZE,i=t.length+this.HEADER_LEN_TOTAL,r=new DataView(new ArrayBuffer(i));return r.setUint32(0,n,!0),r.setUint32(4,n,!0),r.setInt16(8,689,!0),r.setInt16(10,0,!0),new Uint8Array(r.buffer).set(t,this.HEADER_LEN_TOTAL),r.buffer}Decode(e,t){for(this.buffer=this.concat(this.buffer,e).buffer;this.buffer&&this.buffer.byteLength>0;){if(0===this.readLength){if(this.buffer.byteLength<4)return;this.readLength=new DataView(this.buffer).getUint32(0,!0),this.buffer=this.buffer.slice(4)}if(this.buffer.byteLength<this.readLength)return;var n=this.decoder.decode(this.buffer.slice(8,this.readLength-1));this.buffer=this.buffer.slice(this.readLength),this.readLength=0,t(n)}}Blob2ab(e){return new Promise(t=>{var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsArrayBuffer(e)})}Ab2blob(e){return new Blob([e])}}},function(e,t,n){var i=n(0);e.exports=i.isBrowser()?class{constructor(e){this.listener={},this.socket=new WebSocket(e)}send(e){this.socket.send(e)}close(e,t){this.socket.close(e,t)}on(e,t){var n=["open","error","close","message"].find(t=>t===e.toLocaleLowerCase());n&&(Object.keys(this.listener).includes(n)&&this.socket.removeEventListener(n,this.listener[n]),this.listener[n]=t,this.socket.addEventListener(n,t))}}:n(13)},function(e,t,n){function i(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}var r=n(0);e.exports=r.isBrowser()?class{constructor(){this.name="unknown",this.inited=!1,this.db=null,this.version=2}init(e){if(!this.inited){this.name=e;var t=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;this.DB=t.open("danmaku",this.version),this.DB.addEventListener("success",e=>{console.log("连接数据库",event,e),this.db=e.target.result}),this.DB.addEventListener("upgradeneeded",e=>{console.log("升级数据库",event,e),this.db=e.target.result,this.db.createObjectStore("douyu",{keyPath:"id",autoIncrement:!0}).createIndex("idx_room_id","room_id",{unique:!1})}),this.DB.addEventListener("error",e=>{console.log("连接数据库出错 Error:",e)}),this.inited=!0}}echo(e){null!==this.db&&this.db.transaction("douyu","readwrite").objectStore("douyu").add({room_id:this.name,timestamp:(new Date).getTime(),frame:e})}all(e){if(null!==this.db){var t=this.db.transaction("douyu","readonly").objectStore("douyu"),n=e?t.index("idx_room_id").getAll(e):t.getAll();return new Promise((function(e,t){n.addEventListener("success",(function(t){e(t.target.result)})),n.addEventListener("error",(function(){t(!1)}))}))}}count(e){if(null!==this.db){var t=this.db.transaction("douyu","readonly").objectStore("douyu"),n=e?t.index("idx_room_id").count(e):t.count();return new Promise((function(e,t){n.addEventListener("success",(function(){e(n.result)})),n.addEventListener("error",(function(){t(!1)}))}))}}export(e){var t=this;return function(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){function s(e){i(c,r,o,s,a,"next",e)}function a(e){i(c,r,o,s,a,"throw",e)}var c=e.apply(t,n);s(void 0)}))}}((function*(){if(null!==t.db){var n=(yield t.all(e)).reduce((n,i)=>{var r={timestamp:i.timestamp,frame:i.frame};return e||(r.roomId=t.name),n.push(JSON.stringify(r)),n},[]);return r.download(t.name,n.join("\n")),n}}))()}clear(e){if(null!==this.db){var t=this.db.transaction("douyu","readwrite").objectStore("douyu");if(e){var n=t.index("idx_room_id").openCursor(IDBKeyRange.only(e));n.addEventListener("success",(function(){var e=n.result;e&&(e.delete(),e.continue())}))}else t.clear()}}}:n(14)},function(e,t,n){"use strict";n.r(t);var i=n(1),r=n.n(i);window.douyudanmaku=r.a,window.danmaku=r.a},function(e,t,n){var i=n(2),r=n(9),o=n(3),s=n(0),a=n(4),c=n(12);e.exports=class{constructor(e,t){this.roomId=e,this.ws=null,this.logger=null,this.heartbeatTask=null,this.messageEvent=c,this.ignore=[],this.options=this.setOptions(t||{}),this.clientEvent={connect:{name:"open",listener:r.open},disconnect:{name:"close",listener:r.close},error:{name:"error",listener:r.error}}}initSocket(e){this.ws=new e(i.URL),this.ws.on("open",this.clientEvent.connect.listener.bind(this)),this.ws.on("error",this.clientEvent.error.listener.bind(this)),this.ws.on("close",this.clientEvent.disconnect.listener.bind(this)),this.ws.on("message",r.message.bind(this))}send(e){this.ws.send(a.Encode(o.serialize(e)))}login(){this.send({type:"loginreq",roomid:this.roomId})}joinGroup(){this.send({type:"joingroup",rid:this.roomId,gid:0})}heartbeat(){this.heartbeatTask=setInterval(()=>{this.send({type:"mrkl"})},1e3*i.HEARBEAT_INTERVAL)}logout(){this.send({type:"logout"}),clearInterval(this.heartbeatTask)}run(e,t){var i=e||n(5),r=t||n(6);this.logger=new r,this.initSocket(i)}setIgnore(e,t){if(s.isObject(e))for(var n in e)e[n]&&this.ignore.push(n);else t&&this.ignore.push(e);return this}setOptions(e){var t={debug:!1,logfile:"".concat(this.roomId,".log")},n={};return s.isObject(e)?(e.hasOwnProperty("debug")&&s.isBoolean(e.debug)&&(n.debug=e.debug),e.hasOwnProperty("logfile")&&s.isString(e.logfile)&&(n.logfile=e.logfile),Object.assign(t,n)):t}messageHandle(e){a.Decode(e,e=>{var t=o.deserialize(e);this.options.debug&&(this.logger.init(s.isBrowser()?this.roomId:this.options.logfile),this.logger.echo(t)),Object.keys(this.messageEvent).filter(e=>!this.ignore.includes(e)).includes(t.type)&&this.messageEvent[t.type](t)})}on(e,t){var n=Object.keys(this.clientEvent).find(t=>t===e.toLocaleLowerCase());if(n){if("connect"===n){var i=t;t=function(e){this.login(),this.joinGroup(),this.heartbeat(),i.bind(this)(e)}}this.clientEvent[e].listener=t.bind(this)}Object.keys(this.messageEvent).find(t=>t===e.toLocaleLowerCase())&&(this.messageEvent[e]=t.bind(this))}}},function(e,t){e.exports={open:function(){this.login(),this.joinGroup(),this.heartbeat()},error:function(e){console.error(e)},close:function(){this.logout()},message:function(e){if("undefined"!=typeof MessageEvent){var t=new FileReader;t.onload=e=>this.messageHandle(e.target.result),t.readAsArrayBuffer(e.data)}else this.messageHandle(e)}}},function(e,t,n){(function(e){!function(e){function t(){}function n(e,t){if(e=void 0===e?"utf-8":e,t=void 0===t?{fatal:!1}:t,-1==i.indexOf(e.toLowerCase()))throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+e+"') is invalid.");if(t.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}if(e.TextEncoder&&e.TextDecoder)return!1;var i=["utf-8","utf8","unicode-1-1-utf-8"];Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to encode: the 'stream' option is unsupported.");t=0;for(var n=e.length,i=0,r=Math.max(32,n+(n>>1)+7),o=new Uint8Array(r>>3<<3);t<n;){var s=e.charCodeAt(t++);if(55296<=s&&56319>=s){if(t<n){var a=e.charCodeAt(t);56320==(64512&a)&&(++t,s=((1023&s)<<10)+(1023&a)+65536)}if(55296<=s&&56319>=s)continue}if(i+4>o.length&&(r+=8,r=(r*=1+t/e.length*2)>>3<<3,(a=new Uint8Array(r)).set(o),o=a),0==(4294967168&s))o[i++]=s;else{if(0==(4294965248&s))o[i++]=s>>6&31|192;else if(0==(4294901760&s))o[i++]=s>>12&15|224,o[i++]=s>>6&63|128;else{if(0!=(4292870144&s))continue;o[i++]=s>>18&7|240,o[i++]=s>>12&63|128,o[i++]=s>>6&63|128}o[i++]=63&s|128}}return o.slice?o.slice(0,i):o.subarray(0,i)},Object.defineProperty(n.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(n.prototype,"fatal",{value:!1}),Object.defineProperty(n.prototype,"ignoreBOM",{value:!1}),n.prototype.decode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to decode: the 'stream' option is unsupported.");e.buffer instanceof ArrayBuffer&&(e=e.buffer),e=new Uint8Array(e),t=0;for(var n=[],i=[];;){var r=t<e.length;if(!r||65536&t){if(i.push(String.fromCharCode.apply(null,n)),!r)return i.join("");n=[],e=e.subarray(t),t=0}if(0===(r=e[t++]))n.push(0);else if(0==(128&r))n.push(r);else if(192==(224&r)){var o=63&e[t++];n.push((31&r)<<6|o)}else if(224==(240&r)){o=63&e[t++];var s=63&e[t++];n.push((31&r)<<12|o<<6|s)}else if(240==(248&r)){65535<(r=(7&r)<<18|(o=63&e[t++])<<12|(s=63&e[t++])<<6|63&e[t++])&&(r-=65536,n.push(r>>>10&1023|55296),r=56320|1023&r),n.push(r)}}},e.TextEncoder=t,e.TextDecoder=n}("undefined"!=typeof window?window:void 0!==e?e:this)}).call(this,n(11))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var i=n(2);e.exports={loginres:function(){},chatmsg:function(e){console.log("<lv %s> [%s]  %s",e.level+(e.level<10?" ":""),e.nn,e.txt)},uenter:function(e){console.log("欢迎<lv ".concat(e.level,">").concat(e.nn,"进入了直播间"))},upgrade:function(){},rss:function(e){console.log("[开播提醒]",1==e.ss?i.MSG_LIVE_ON:i.MSG_LIVE_OFF)},bc_buy_deserve:function(){},ssd:function(){},spbc:function(e){console.log("------------- 感谢[".concat(e.sn,"] 赠送的 ").concat(e.gn,"x").concat(e.gc))},dgb:function(){},onlinegift:function(e){console.log("------------- [".concat(e.nn,"] 领取鱼丸x").concat(e.sil))},ggbb:function(){},rankup:function(){},ranklist:function(){},mrkl:function(){},erquizisn:function(){},blab:function(){},rri:function(){},synexp:function(){},noble_num_info:function(){},gbroadcast:function(){},qausrespond:function(){},wiru:function(){},wirt:function(){},mcspeacsite:function(){},rank_change:function(){},srres:function(){},anbc:function(){},frank:function(){}}},function(e,t,n){"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},function(e,t,n){function i(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}var r=n(15);e.exports=class{constructor(){this.name="unknown",this.inited=!1}init(e){this.inited||(this.name=e,this.inited=!0)}echo(e){var t="".concat(JSON.stringify({timestamp:(new Date).getTime(),frame:e}),"\n");r.appendFile(this.name,t,(function(e){e&&console.error("日志保存出错, Error:",e)}))}all(){return new Promise((e,t)=>{r.readFile(this.name,"utf8",(function(n,i){n?t(n):e(i)}))})}count(){var e=this;return new Promise(function(){var t=function(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){function s(e){i(c,r,o,s,a,"next",e)}function a(e){i(c,r,o,s,a,"throw",e)}var c=e.apply(t,n);s(void 0)}))}}((function*(t){t((yield e.all()).split("\n").filter(e=>""!==e).length)}));return function(){return t.apply(this,arguments)}}())}export(){return r.readFileSync(this.name,"utf8")}clear(){try{return r.writeFileSync(this.name,"","utf8")}catch(e){return!1}}}},function(e,t){}]);